// C program to implement one side of FIFO 
// This side reads first, then reads 
#include <stdio.h> 
#include <string.h> 
#include <fcntl.h> 
#include <sys/stat.h> 
#include <sys/types.h> 
#include <unistd.h> 

int main()
{
	int fd1;
	int fdwrite;
	int fdread;
	char reponse[100];
	char *myfifo = "TestFifo"; //fifo filr path
	char *tube_serveur = "tube_serveur";
	char *tube_client = "tube_client";

	mkfifo(myfifo, 0666);//creating the named file(FIFO)
	mkfifo(tube_serveur, 0666);
	mkfifo(tube_client, 0666);

	char str1[80], str2[80];
	char requet[100];
	while(1)
	{
		fdwrite = open(tube_serveur, O_WRONLY );
		fgets(requet, 100, stdin);
		write(fdwrite, requet, strlen(requet)+1 );
		close(fdwrite);

		fdread = open(tube_client, O_RDONLY);
		read(fdread, reponse, 100 );
		close(fdread);
		printf("%s\n",reponse);
/*
		fd1 = open(myfifo, O_RDONLY); //first open in read only and read
		read(fd1, str1, 80);

		printf("USER1: %s\n", str1); //print the read line and close
		close(fd1);

		fd1 = open(myfifo, O_WRONLY);// now open in write mode and write
										//string taken from user
		fgets(str2, 80, stdin);
		write(fd1, str2, strlen(str2)+1);
		close(fd1);
*/
	}
	return 0;
}
