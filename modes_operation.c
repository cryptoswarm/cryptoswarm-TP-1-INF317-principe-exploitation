#include "commandes.h"
#include <readline/readline.h>
#include <stdio.h>

void mode_fichier(char* nom_fichier, char* envp[]){
	FILE* fichier = fopen(nom_fichier, "r"); //ouverture lecture simple
	char buffer[512]; //max 512 caracteres par ligne
	int i=0;
	//char** editcommande;
	char** commande;
	size_t num; // = strlen( commande[i] ) -1;
	char **array = malloc(8 * sizeof(char *));
	if(NULL == fichier){
		printf("Erreur lors de l'ouverture du fichier %s\n", nom_fichier);
		return;
	}
	
	//while(!feof(fichier)){ //tant que le fichier n'est pas fini
	while( fgets( buffer, sizeof(buffer), fichier ) != NULL )
	{
		commande = parseInput(buffer);
		//editcommande = editEndOfString(commande);
		while(commande[i] != NULL)
		{
			num = strlen( commande[i] );
			/*
			for(int j=0; j<strlen(commande[i]); j++)
			{
				if( commande[i][j]  == '\n' )
				{
					commande[i][j]  == '\0';
				}
			}
			*/
			strncpy(array[i], commande[i], num );
			++i;
		}
		array[i] = NULL;
		ownCmdHandler(array, envp);//commande, envp);
	}
	
	fclose(fichier);
}

void mode_stdin(char* envp[]){
	char *input;
	char **commande;
	
	while(1){
		input = readline("monshell>> ");
		commande = parseInput(input);
		
		ownCmdHandler(commande, envp);
	}
	
	free(input);
	free(commande);
}

/*char** editEndOfString( char *tab[] )
{
	char **array = malloc(8 * sizeof(char *));
	int i=0;
	size_t num = strlen(tab[i]) -1;
	while(tab[i] != NULL )
	{
		strncpy(array[i], tab[i], num );
		++i;
	}
	array[i] = NULL;
	return array;
}
*/
