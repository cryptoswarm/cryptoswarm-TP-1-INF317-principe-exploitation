#include "commandes.h"
#include <readline/readline.h>
#include <readline/history.h>
#include <stdio.h>

void mode_fichier(char* nom_fichier, char* envp[]){
	FILE* fichier = fopen(nom_fichier, "r"); //ouverture lecture simple
	char buffer[512]; //max 512 caracteres par ligne
	int i=0;
	char** commande;

	if(NULL == fichier){
		printf("Erreur lors de l'ouverture du fichier %s\n", nom_fichier);
		return;
	}
	while( fgets( buffer, sizeof(buffer), fichier ) != NULL )
	{
		commande = parseInput(buffer);
		ownCmdHandler(commande, envp);//commande, envp);
	}
	free(commande);
	fclose(fichier);
}

void mode_stdin(char* envp[]){
	char *input;
	char **commande;
	char cwd[1024];
	char *rl_prompt = getcwd( cwd, sizeof(cwd) );
	strcat(rl_prompt, " >>");

	while(1){
		input = readline(rl_prompt);//"monshell>> ");
		if( input && *input) add_history( input ); //Si la ligne lue n'est pas vide, on la sauvegarde pour une utilisation ulterieur.
		commande = parseInput(input);

		ownCmdHandler(commande, envp);
	}

	free(input);
	free(commande);
}
