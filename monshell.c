#include <stdio.h>
#include <sys/wait.h>
#include <unistd.h>
#include <stdlib.h>
#include <readline/readline.h>
#include <string.h>

#include "commandes.h"

char **get_input(char *input) {

    char **command = malloc(8 * sizeof(char *));
    if (command == NULL) {
    	perror("malloc failed");
        exit(1);
    }

    char *separator = " ";
    char *parsed;
    int index = 0;

    parsed = strtok(input, separator);
    while (parsed != NULL) {
    	command[index] = parsed;
        index++;

        parsed = strtok(NULL, separator);
    }

    command[index] = NULL;
    return command;
}


int main(int argc, char *argv[], char *envp[])
{
	char **command;
	char *input;
	pid_t child_pid;
	int stat_loc;
	char buffer[1024];

	while(1)
	{
		input = readline("monshell>> ");

		command = get_input(input);

		if( strcmp( command[0], "cd" ) == 0)
		{
			changeDir( command );
			continue;
		}
		if( strcmp( command[0], "clr" ) == 0)
		{
			clearScreaan();
			continue;
		}
		if(strcmp( command[0], "dir" ) == 0)
		{
			//listContentOfDirectory();
			//continue;
		}
		if(strcmp( command[0], "environ" ) == 0)
		{
			listerContenuEnv(envp);
			continue;
		}
		if(strcmp( command[0], "echo" ) == 0)
		{
			echoComment(command);
			continue;
		}
		if( strcmp( command[0], "quit" ) == 0)
		{
			exit(0);
		}


		myexecl(command);
		free(input);
		free(command);
	}
	return 0;
}
